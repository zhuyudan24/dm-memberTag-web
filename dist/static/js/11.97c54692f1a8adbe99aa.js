webpackJsonp([11],{C3xr:function(e,t){},q0vu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),s=a.n(r),o=a("mvHQ"),l=a.n(o),i=a("woOf"),u=a.n(i),n=(a("zFZp"),a("3Xzz")),c=a("Gndl"),m=a("jkVl"),g=a("vcge"),p=a("3E4D"),d=a("P9l9"),h=a("OOvn"),f=a("2CGT"),v={name:"memberGroupEdit",data:function(){var e=this;return{templateCode:"",ruleForm:{memberTagGroupId:"",memberTagGroupClassifyId:"",selectedTags:[[]],tagsGroupRelation:[],newTagVal:"",groupName:"",effectiveDateTmp:"",describle:"",isActive:0,updateType:"",updateDay:"",effectiveStatus:1},refreshList:{},activeTagsGroupIndex:0,activeTagIndex:0,pickerOptions:{disabledDate:function(e){var t=(new Date).getTime()+31536e6;return e.getTime()<Date.now()-864e5||e.getTime()>t}},memberGroupList:{},rules:{selectedTags:[{type:"array",required:!0,message:"请选择标签",trigger:"blur"}],groupName:[{required:!0,message:"请输入分组名称",trigger:"blur"}],effectiveDateTmp:[{required:!0,message:"请选择分组过期时间",trigger:"change"}],updateType:[{validator:function(t,a,r){console.log(a),0==e.ruleForm.isActive&&""==a?r(new Error("请选择更新频率")):r()},trigger:"blur"}],updateDay:[{validator:function(t,a,r){console.log(a,e.ruleForm),0!=e.ruleForm.isActive||"1"==e.ruleForm.updateType&&""!=e.ruleForm.updateType||""!=a?r():(console.log(a,e.ruleForm),r(new Error("请选择更新频率")))},trigger:"change"}]},rateData:[{label:"每日一次",options:[]},{label:"每周一次",options:["周一","周二","周三","周四","周五","周六","周日"]},{label:"每月一次",options:["1号","2号","3号","4号","5号","6号","7号","8号","9号","10号","11号","12号","13号","14号","15号","16号","17号","18号","19号","20号","21号","22号","23号","24号","25号","26号","27号","28号"]}],showSelectTagPop:!1,tagsList:[],tagsGroupList:[],searchData:"",showEditTagPop:!1,editPopType:"add",tagData:{},pageNum:1,pageSize:20,total:0}},computed:{navpath:function(){var e=this.$route.query.memberTagGroupId;return[{name:"首页",path:window.location.origin+"/report/#/memberSummary",relocation:!0},{name:"会员标签",path:""},{name:"会员分组",path:"/memberGroupList"},{name:e?"会员分组编辑":"新增会员分组",path:""}]}},watch:{"ruleForm.selectedTags":{deep:!0,handler:function(){var e=0===this.ruleForm.selectedTags.length||this.ruleForm.selectedTags.some(function(e){return 0===e.length||e.some(function(e){return 0===parseInt(e.isActive)})});this.ruleForm.isActive=e?0:1}}},methods:{changeRoute:function(e){this.$router.push(e)},refresh:function(e){e.changeRefersh=!0,this.refershList=e},addTags:function(){this.editPopType="add",this.showSelectTagPop=!0},editTags:function(){var e=this;this.editPopType="edit",this.showEditTagPop=!0,this.$nextTick(function(){e.tagData=u()({},e.tagData,e.ruleForm.selectedTags[e.activeTagsGroupIndex][e.activeTagIndex]),e.tagData.editCondition=!0})},selectedTag:function(e){this.showEditTagPop=!0,this.tagData=u()({},this.tagData,e),this.tagData.editCondition=!1},returnTagData:function(e){var t=this,a=JSON.parse(e.tagParams);switch(e.newTagVal=l()(a.selectedVal),e.level=this.activeTagsGroupIndex,this.editPopType){case"add":this.ruleForm.selectedTags[this.activeTagsGroupIndex].some(function(t){return t.tagId===e.tagId})?this.ruleForm.selectedTags[this.activeTagsGroupIndex].forEach(function(a,r){a.tagId===e.tagId&&t.ruleForm.selectedTags[t.activeTagsGroupIndex].splice(r,1,e)}):this.ruleForm.selectedTags[this.activeTagsGroupIndex].push(e);break;case"edit":var r=this.ruleForm.selectedTags[this.activeTagsGroupIndex];r.splice(this.activeTagIndex,1,s()({},r[this.activeTagIndex],e)),this.ruleForm.selectedTags.splice(this.activeTagsGroupIndex,1,r)}},confirmSavePost:function(){var e=this;this.$refs.ruleForm.validate(function(t){if(t){var a=0===e.ruleForm.isActive&&1!==e.ruleForm.updateType&&""===e.ruleForm.updateDay,r=0===e.ruleForm.selectedTags.length||e.ruleForm.selectedTags.some(function(e){return 0===e.length});if(a)return e.$message.error({message:"请选择更新频率!"}),!1;if(r)return e.$message.error({message:"请至少保留一个标签!"}),!1;e.postSave()}})},postSave:function(){var e=this,t=this.ruleForm;t.selectedTags.forEach(function(e,a){var r=t.tagsGroupRelation[a-1];e.forEach(function(e){e.levelType=r||"or"})});var a={memberTagGroupId:t.memberTagGroupId,memberTagGroupClassifyId:t.memberTagGroupClassifyId,groupName:t.groupName,isRealTime:t.isActive,describle:t.describle,updateType:t.updateType,updateDay:t.updateDay,effectiveStatus:t.effectiveStatus,json:l()(t.selectedTags),effectiveDateTmp:t.effectiveDateTmp.split(" ")[0]+" 23:59:59"},r=this.ruleForm.memberTagGroupId?"/member-tag-group/update.json":"/member-tag-group/add.json";Object(d.b)(r,a).then(function(t){1===t.data.errorCode?(p.a.showmsg(e.ruleForm.memberTagGroupId?"编辑成功":"新增成功","success"),e.changeRoute("/memberGroupList")):e.$message.warning(t.data.message)}).catch(function(t){e.$message.warning(t)})},getTagsList:function(){var e=this;Object(h.a)({url:"/memberTag/platformHomePageCountV2",method:"get",params:{requestProject:"gic-member-tag-web"}}).then(function(t){t.result&&t.result.length?(e.tagsList=t.result,e.tagsList.forEach(function(e){e.nameStr=e.name,e.children.forEach(function(e){e.nameStr=e.name,e.children.forEach(function(e){e.nameStr=e.name,e.count&&e.count>0&&(e.nameStr=e.name+" ("+e.count+")")})})})):e.tagsList=[]})},getTagsGroupList:function(e){var t=this,a={requestProject:"gic-member-tag-web",search:(e=e||{}).searchName||null,tagLevelGroupId:e.id||0,tagType:e.type||null,pageNum:this.pageNum,pageSize:this.pageSize};Object(f.j)(a).then(function(e){e.result.result&&e.result.result.length?(t.tagsGroupList=e.result.result,t.total=e.result.totalCount):(t.tagsGroupList=[],t.total=0),console.log("tagsGroupList",t.tagsGroupList)})},searchTags:function(){this.searchData.length>0&&(this.pageNum=1,this.getTagsGroupList({searchName:this.searchData}))},treeClick:function(e,t){3===t.level&&(this.pageNum=1,this.getTagsGroupList({id:e.id,type:e.handTag}))},handleSizeChange:function(e){this.pageSize=e,this.pageNum=1,this.getTagsGroupList()},handleCurrentChange:function(e){this.pageNum=e,this.getTagsGroupList()},getGroupData:function(){var e=this;Object(d.b)("/member-tag-group/findOneDetial.json",{memberTagGroupId:this.ruleForm.memberTagGroupId}).then(function(t){var a=t.data;if(1==a.errorCode){var r=a.result.tagGroupDto;console.log("tagGroupDto",r.memberTagGroupClassifyId),r&&(e.ruleForm.memberTagGroupClassifyId=r.memberTagGroupClassifyId||"0",e.ruleForm.groupName=r.groupName,e.ruleForm.isActive=r.isRealTime,e.ruleForm.effectiveStatus=r.effectiveStatus,e.ruleForm.describle=r.describle,e.ruleForm.effectiveDateTmp=r.effectiveDate,e.ruleForm.updateType=r.updateType?Number(r.updateType):"",e.ruleForm.updateDay=r.updateDay?Number(r.updateDay):"");var s=Array.isArray(a.result.tagValueDtoList)?a.result.tagValueDtoList:[];e.ruleForm.selectedTags=s.map(function(e){return e.map(function(e){if("[object Object]"===Object.prototype.toString.call(e)){var t=JSON.parse(e.tagParams);e.newTagVal=t.selectedVal?l()(t.selectedVal):""}return e})}),e.ruleForm.selectedTags=e.ruleForm.selectedTags.filter(function(e){return e.length>0}),e.ruleForm.selectedTags.map(function(t,a){e.ruleForm.selectedTags[a+1]&&e.ruleForm.tagsGroupRelation.push(e.ruleForm.selectedTags[a+1][0].levelType?e.ruleForm.selectedTags[a+1][0].levelType:"or")})}}).catch(function(e){console.log(e)})},getMemberGroupList:function(){var e=this;Object(f.l)({requestProject:"gic-member-tag-web"}).then(function(t){var a=t.errorCode,r=t.message,s=t.result;1===a?((s=s||[]).forEach(function(e){"b3a45c4711134c939b5f8ee31a10f646"===e.memberTagGroupClassifyId&&console.log(e)}),e.memberGroupList=s.slice(0),console.log("memberTagGroupClassifyId",e.ruleForm.memberTagGroupClassifyId),e.ruleForm.memberTagGroupClassifyId=e.ruleForm.memberTagGroupClassifyId||"0"):e.$message.error(r)}).catch(function(e){console.log(e)})}},mounted:function(){var e=sessionStorage.getItem("selectTempTag"),t=this.$route.query.memberTagGroupId;if(e&&(this.ruleForm.selectedTags=JSON.parse(e),sessionStorage.removeItem("selectTempTag")),t)this.ruleForm.memberTagGroupId=t,this.getGroupData();else{var a=new Date((new Date).getTime()+31536e6),r=a.getFullYear()+"-",s=(a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1)+"-",o=(a.getDate()<10?"0"+a.getDate():a.getDate())+" ";this.ruleForm.effectiveDateTmp=r+s+o+"23:59:59"}this.getTagsList(),this.getTagsGroupList(),this.getMemberGroupList()},components:{navCrumb:n.a,tagsGroupList:g.default,tagContainer:c.default,editTag:m.default}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"common-wrap"},[a("nav-crumb",{attrs:{navpath:e.navpath}}),e._v(" "),a("div",{staticClass:"right-content"},[a("div",{staticClass:"right-box"},[a("div",{staticClass:"memberGroupEdit-wrap__body"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules}},[a("el-form-item",{attrs:{label:"",prop:"selectedTag"}},[a("div",{class:["label-title",{"m-l-60":e.ruleForm.selectedTags.length>1}]},[e._v("\n              已选标签\n              "),a("span",{staticClass:"color-909399 font-14"},[e._v("（同一个输入框内标签关系为且）")])]),e._v(" "),a("tags-group-list",{attrs:{selectedTagsData:e.ruleForm.selectedTags,tagsGroupRelation:e.ruleForm.tagsGroupRelation,activeTagsGroupIndex:e.activeTagsGroupIndex,activeTagIndex:e.activeTagIndex,showAddMenu:!0},on:{"update:activeTagsGroupIndex":function(t){e.activeTagsGroupIndex=t},"update:activeTagIndex":function(t){e.activeTagIndex=t},addTags:e.addTags,editTags:e.editTags}})],1),e._v(" "),a("el-form-item",{class:["w-220",{"m-l-60":e.ruleForm.selectedTags.length>1}],attrs:{label:"",prop:"groupName"}},[a("div",{staticClass:"label-title"},[e._v("分组名称")]),e._v(" "),a("el-input",{staticClass:"w-220",attrs:{maxlength:10,placeholder:"请输入分组名称"},model:{value:e.ruleForm.groupName,callback:function(t){e.$set(e.ruleForm,"groupName",t)},expression:"ruleForm.groupName"}}),e._v(" "),a("label",{staticClass:"input-label"},[e._v(e._s(e.ruleForm.groupName.length)+"/10")])],1),e._v(" "),a("el-form-item",{class:{"m-l-60":e.ruleForm.selectedTags.length>1},attrs:{label:"",prop:"effectiveDateTmp"}},[a("div",{staticClass:"effective label-title"},[e._v("\n              分组有效期\n              "),a("el-tooltip",{attrs:{content:"分组有效期需早于所用标签的最早有效期，且最长不超过365天"}},[a("i",{staticClass:"form-tip-icon"},[e._v("i")])])],1),e._v(" "),a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd HH:mm:ss","default-time":"23:59:59","picker-options":e.pickerOptions},model:{value:e.ruleForm.effectiveDateTmp,callback:function(t){e.$set(e.ruleForm,"effectiveDateTmp",t)},expression:"ruleForm.effectiveDateTmp"}})],1),e._v(" "),a("el-form-item",{class:{"m-l-60":e.ruleForm.selectedTags.length>1},attrs:{label:"",prop:""}},[a("div",{staticClass:"label-title"},[e._v("分组所属分类")]),e._v(" "),a("el-select",{model:{value:e.ruleForm.memberTagGroupClassifyId,callback:function(t){e.$set(e.ruleForm,"memberTagGroupClassifyId",t)},expression:"ruleForm.memberTagGroupClassifyId"}},e._l(e.memberGroupList,function(e){return a("el-option",{key:e.memberTagGroupClassifyId,attrs:{value:e.memberTagGroupClassifyId,label:e.classifyName}})}))],1),e._v(" "),a("el-form-item",{class:["w-400",{"m-l-60":e.ruleForm.selectedTags.length>1}],attrs:{label:"",prop:"describle"}},[a("div",{staticClass:"label-title"},[e._v("分组描述")]),e._v(" "),a("el-input",{staticClass:"w-400",attrs:{type:"textarea",maxlength:200,rows:"4"},model:{value:e.ruleForm.describle,callback:function(t){e.$set(e.ruleForm,"describle",t)},expression:"ruleForm.describle"}}),e._v(" "),a("label",{staticClass:"textarea-label"},[e._v(e._s(e.ruleForm.describle.length)+"/200")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:0==e.ruleForm.isActive,expression:"ruleForm.isActive == 0"}],class:{"m-l-60":e.ruleForm.selectedTags.length>1},attrs:{label:"",prop:"updateDay"}},[a("div",{staticClass:"label-title"},[e._v("\n              更新频率\n              "),a("span",{staticClass:"form-tip-text"},[e._v("(更新时间预计选择日期的凌晨0点至6点)")])]),e._v(" "),a("el-select",{staticClass:"w-200",attrs:{placeholder:"请选择"},on:{change:function(t){e.ruleForm.updateDay=""}},model:{value:e.ruleForm.updateType,callback:function(t){e.$set(e.ruleForm,"updateType",t)},expression:"ruleForm.updateType"}},e._l(e.rateData,function(e,t){return a("el-option",{key:e.label,attrs:{label:e.label,value:t+1}})})),e._v(" "),a("el-select",{directives:[{name:"show",rawName:"v-show",value:1!=e.ruleForm.updateType,expression:"ruleForm.updateType != 1"}],staticClass:"w-200 p-l-8",attrs:{placeholder:"请选择"},model:{value:e.ruleForm.updateDay,callback:function(t){e.$set(e.ruleForm,"updateDay",t)},expression:"ruleForm.updateDay"}},e._l(e.rateData[e.ruleForm.updateType?e.ruleForm.updateType-1:0].options,function(e,t){return a("el-option",{key:e,attrs:{label:e,value:t+1}})}))],1),e._v(" "),a("el-form-item",{class:{"m-l-60":e.ruleForm.selectedTags.length>1},attrs:{label:""}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){t.stopPropagation(),e.confirmSavePost(t)}}},[e._v(e._s(e.$route.query.memberTagGroupId?"保存":"创建会员分组"))]),e._v(" "),a("el-button",[a("router-link",{attrs:{to:"/memberGroupList"}},[e._v("返回")])],1)],1)],1)],1)])]),e._v(" "),a("el-dialog",{attrs:{visible:e.showSelectTagPop,title:"选择标签","custom-class":"tags-body",width:"980px"},on:{"update:visible":function(t){e.showSelectTagPop=t}}},[a("div",{staticClass:"tags"},[a("div",{staticClass:"tags-list"},[a("el-tree",{attrs:{data:e.tagsList,props:{label:"nameStr",children:"children"},"default-expand-all":!0,"highlight-current":!0},on:{"node-click":e.treeClick}})],1),e._v(" "),a("div",{staticClass:"tags-table"},[a("div",{staticClass:"tags-search"},[a("el-input",{attrs:{type:"search",placeholder:"请输入关键词回车搜索标签","prefix-icon":"el-icon-search"},nativeOn:{keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.searchTags(t)}},model:{value:e.searchData,callback:function(t){e.searchData=t},expression:"searchData"}})],1),e._v(" "),a("tag-container",{staticStyle:{height:"475px"},attrs:{data:e.tagsGroupList,refersh:e.refreshList},on:{addTag:e.selectedTag}}),e._v(" "),a("div",{staticClass:"page-box"},[e.total>0?a("el-pagination",{attrs:{background:"","current-page":e.pageNum,"page-sizes":[20,30],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e()],1)],1)])]),e._v(" "),a("edit-tag",{attrs:{showEditTagPop:e.showEditTagPop,tagData:e.tagData,title:"add"===e.editPopType?"添加标签":"编辑标签"},on:{"update:showEditTagPop":function(t){e.showEditTagPop=t},returnTagData:e.returnTagData,refersh:e.refresh}}),e._v(" "),a("vue-gic-footer")],1)},staticRenderFns:[]};var b=a("VU/8")(v,T,!1,function(e){a("C3xr")},"data-v-2c891a23",null);t.default=b.exports},zFZp:function(e,t){}});