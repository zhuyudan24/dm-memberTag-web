webpackJsonp([20],{"8WW0":function(e,t){},f0o3:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mvHQ"),o=a.n(r),n=a("3Xzz"),i=a("5QTb"),s=a("Mk6G"),l=a("3E4D"),c=a("Ch4/"),u=(a("PI0u"),a("P9l9")),g={name:"manualTagList",data:function(){return{navpath:[{name:"首页",path:window.location.origin+"/report/#/memberSummary",relocation:!0},{name:"会员管理",path:""},{name:"会员标签",path:""},{name:"手工标签库",path:"/manualTagLib"},{name:"手工标签列表",path:""}],tagLibName:"manualTag",tagSearch:"",tagTableData:[],selTagTableData:[],currentPage:1,pageSize:20,total:0,currentGroupId:0,cateTableVisible:!1,inputNum:0,limitLength:10,cateForm:{cateTwo:"",cateThree:""},rules:{cateTwo:[{required:!0,message:"请选择分类",trigger:"blur"}],cateThree:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},cateTwOptions:[],cateTableData:[]}},methods:{changeRoute:function(e){this.$router.push(e)},toAddMyTagLib:function(e,t){console.log(t);var a={};if("mult"===e){if(!this.selTagTableData.length)return this.$message.error({message:"请选择标签"}),!1;a.tagIds=[],this.selTagTableData.forEach(function(e,t){a.tagIds.push(e.tagId)}),console.log(a),a.tagIds=a.tagIds.join(","),this.addByTagId("addByTagIds",a)}else a.tagId=t,this.addByTagId("addByTagId",a)},addByTagId:function(e,t){var a=this;Object(u.a)("/enterpriseMemberTag/"+e,t).then(function(e){var t=e.data;if(1==t.errorCode)return l.a.showmsg("添加成功","success"),void a.getTagList();c.a.errorMsg(t)}).catch(function(e){console.log(e),a.$message.error({duration:1e3,message:e.message})})},searchEnterFun:function(e){console.log(e),this.currentPage=1,this.getTagList()},clearSearch:function(){this.currentPage=1,this.getTagList()},handleSelectChange:function(e){this.selTagTableData=e},handleSizeChange:function(e){this.pageSize=e,this.getTagList()},handleCurrentChange:function(e){this.currentPage=e,this.$route.fullPath.includes("?")&&this.$router.push(this.$route.path+"?tagLevelGroupId="+this.$route.query.tagLevelGroupId+"&currentPage="+e),this.getTagList()},getTagList:function(e){var t=this,a={tagName:t.tagSearch,tagLevelGroupId:t.currentGroupId,pageNum:t.currentPage,pageSize:t.pageSize};Object(u.a)("/memberTag/handTagPageList",a).then(function(e){var a=e.data;if(1==a.errorCode)return t.tagTableData=a.result.result,void(t.total=a.result.totalCount);c.a.errorMsg(a)}).catch(function(e){console.log(e),t.$message.error({duration:1e3,message:e.message})})},cancelDelTag:function(e,t){t.popVisible=!1},toDelTag:function(e,t){var a=this;a.$confirm("删除标签后，符合该标签值的会员对应标签值将同步删除。一旦删除将无法恢复，确认要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.postDelTag(e,t)}).catch(function(){})},postDelTag:function(e,t){var a=this,r={tagId:t.tagId};Object(u.a)("/memberTag/delHandMemberTag",r).then(function(t){var r=t.data;if(1==r.errorCode)return a.tagTableData.splice(e,1),void l.a.showmsg("删除成功","success");100005!=r.errorCode?c.a.errorMsg(r):a.$message.error({duration:1e3,message:"该标签正在被会员分组使用，无法删除！"})}).catch(function(e){a.$message.error({duration:1e3,message:e.message})})},toManualTagEdit:function(){this.changeRoute("/manualTagEdit")},isRepeat:function(e){var t={};for(var a in e){if(t[e[a]])return!0;t[e[a]]=!0}return!1},showCateDialog:function(){this.cateTableVisible=!0,this.getTWoLevel()},cateTwoChange:function(e){this.cateForm.cateThree="",this.inputNum=0,this.getThreeLevel(e)},toAddCate:function(e){var t=this;t.$refs[e].validate(function(e){if(!e)return!1;t.cateForm.levelName=t.cateForm.cateThree,t.cateForm.editAble=!1,t.cateForm.inputValue="";var a=JSON.parse(o()(t.cateTableData));a.push(JSON.parse(o()(t.cateForm)));var r=a.map(function(e){return e.levelName});if(t.isRepeat(r))return a.splice(t.cateTableData.length-1,1),void t.$message.error({duration:1e3,message:"名称不能重复"});t.postAdd()})},postAdd:function(){var e=this,t={parentLevelGroupId:e.cateForm.cateTwo,levelName:e.cateForm.cateThree};Object(u.a)("/tagLevel/addHand",t).then(function(t){var a=t.data;if(1==a.errorCode)return e.$refs.tagCategoryCom.refreshData(),l.a.showmsg("添加成功","success"),void e.getThreeLevel(e.cateForm.cateTwo);c.a.errorMsg(a)}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})},toEditCate:function(e,t){t.editAble=!0,t.inputValue=t.levelName},toDelCate:function(e,t){var a=this;a.$confirm("删除分类后，该分类下所有标签进入未分类，确认要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.postDel(e,t)}).catch(function(){})},postDel:function(e,t){var a=this,r={tagLevelGroupId:t.tagLevelGroupId};Object(u.a)("/tagLevel/delHand",r).then(function(t){var r=t.data;if(1==r.errorCode)return a.cateTableData.splice(e,1),a.$refs.tagCategoryCom.refreshData(),void l.a.showmsg("删除成功","success");200001!=r.errorCode?c.a.errorMsg(r):a.$message.error({duration:1e3,message:"该标签被会员分组使用，无法删除!"})}).catch(function(e){a.$message.error({duration:1e3,message:e.message})})},confirmEdit:function(e,t){if(!t.inputValue.trim())return this.$message.error({duration:1e3,message:"请输入分类名称"}),!1;var a=JSON.parse(o()(this.cateTableData));a[e].levelName=t.inputValue;var r=a.map(function(e){return e.levelName});this.isRepeat(r)?this.$message.error({duration:1e3,message:"名称不能重复"}):this.postEdit(t)},postEdit:function(e){var t=this,a={tagLevelGroupId:e.tagLevelGroupId,levelName:e.inputValue};Object(u.a)("/tagLevel/editHand",a).then(function(a){var r=a.data;if(1==r.errorCode)return e.levelName=e.inputValue,e.editAble=!1,t.$refs.tagCategoryCom.refreshData(),void l.a.showmsg("保存成功","success");c.a.errorMsg(r)}).catch(function(e){t.$message.error({duration:1e3,message:e.message})})},cancleEdit:function(e,t){t.editAble=!1},toInput:function(e){var t="";t=s.a.getByteVal(e.target.value,this.limitLength),this.cateForm.cateThree=t.trim(),this.inputNum=s.a.getZhLen(t.trim())},toEditInput:function(e,t,a){var r="";r=s.a.getByteVal(e.target.value,this.limitLength),a.inputValue=r.trim()},closeCateDialog:function(){this.cateTableVisible=!1,this.cateForm.cateTwo="",this.cateForm.cateThree="",this.cateTableData=[],this.inputNum=0},cancelDialog:function(){this.closeCateDialog()},confirmDialog:function(){this.closeCateDialog()},getTWoLevel:function(){var e=this;Object(u.a)("/tagLevel/handSecondLevel",{}).then(function(t){var a=t.data;if(1==a.errorCode)return e.cateTwOptions=a.result,e.cateForm.cateTwo=e.cateTwOptions[0].tagLevelGroupId,void e.getThreeLevel(e.cateForm.cateTwo);c.a.errorMsg(a)}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})},getThreeLevel:function(e){var t=this,a={tagLevelGroupId:e};t.cateTableData=[],Object(u.a)("/tagLevel/handThirdLevel",a).then(function(e){var a=e.data;if(1==a.errorCode)return a.result.forEach(function(e,t){e.inputValue="",e.editAble=!1}),void(t.cateTableData=a.result);c.a.errorMsg(a)}).catch(function(e){t.$message.error({duration:1e3,message:e.message})})},getUrlParams:function(){this.tagSearch=this.$route.query.searchName?this.$route.query.searchName:"",this.currentGroupId=this.$route.query.tagLevelGroupId?this.$route.query.tagLevelGroupId:0,this.currentPage=this.$route.query.currentPage?parseInt(this.$route.query.currentPage):1,document.getElementById("app").style.zIndex="auto",this.getTagList()}},watch:{$route:{handler:function(e,t){this.getUrlParams()},deep:!0}},mounted:function(){this.getUrlParams()},components:{navCrumb:n.a,tagCategory:i.a}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"manualTagList-wrap common-wrap"},[a("nav-crumb",{attrs:{navpath:e.navpath}}),e._v(" "),a("div",{staticClass:"right-content"},[a("div",{staticClass:"right-box"},[a("div",{staticClass:"common-wrap__cateTags"},[a("tag-category",{ref:"tagCategoryCom",attrs:{tagLibName:e.tagLibName}})],1),e._v(" "),a("div",{staticClass:"common-wrap__opt"},[a("el-input",{staticClass:"w-184",attrs:{placeholder:"搜索标签","prefix-icon":"el-icon-search",clearable:""},on:{clear:e.clearSearch},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.searchEnterFun(t)}},model:{value:e.tagSearch,callback:function(t){e.tagSearch=t},expression:"tagSearch"}}),e._v(" "),a("el-button",{staticClass:"fr m-l-8",on:{click:function(t){e.toAddMyTagLib("mult")}}},[e._v("添加至我的标签库")]),e._v(" "),a("el-button",{staticClass:"fr",on:{click:e.showCateDialog}},[e._v("分类设置")]),e._v(" "),a("el-button",{staticClass:"fr",attrs:{type:"primary"},on:{click:e.toManualTagEdit}},[e._v("新增标签")])],1),e._v(" "),a("div",{staticClass:"common-wrap__table m-t-20"},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tagTableData,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectChange}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{prop:"tagName",label:"标签名称","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"tagDescribe",label:"标签描述","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"是否实时"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(1==t.row.isActive?"实时":"非实时")+"\n            ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"320"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{staticClass:"edit-btn el-button--text",attrs:{to:{path:"/manualTagDetail",query:{tagId:t.row.tagId,addFlag:t.row.isAdd,form:"notMyTag",navSign:"manualTag"}}}},[e._v("详情")]),e._v(" "),a("router-link",{staticClass:"edit-btn el-button--text p-l-10",attrs:{to:{path:"/manualTagEdit",query:{tagId:t.row.tagId}}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticClass:"p-l-10",attrs:{slot:"reference",type:"text"},on:{click:function(a){e.toDelTag(t.$index,t.row)}},slot:"reference"},[e._v("\n                删除\n              ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small",disabled:1==t.row.isAdd},on:{click:function(a){e.toAddMyTagLib("single",t.row.tagId)}}},[e._v("\n                "+e._s(1==t.row.isAdd?"已":"")+"添加至我的标签库\n              ")])]}}])})],1)],1),e._v(" "),0!=e.tagTableData.length?a("div",{staticClass:"block common-wrap__page text-right"},[a("el-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):e._e()])]),e._v(" "),a("vue-gic-footer"),e._v(" "),a("el-dialog",{staticClass:"cate-dialog",attrs:{title:"分类设置",visible:e.cateTableVisible,width:"543px","before-close":e.closeCateDialog},on:{"update:visible":function(t){e.cateTableVisible=t}}},[a("el-form",{ref:"cateForm",attrs:{model:e.cateForm,rules:e.rules,"label-width":"80px","label-position":"left"}},[a("el-form-item",{attrs:{label:"二级分类",prop:"cateTwo"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cateTwoChange},model:{value:e.cateForm.cateTwo,callback:function(t){e.$set(e.cateForm,"cateTwo",t)},expression:"cateForm.cateTwo"}},e._l(e.cateTwOptions,function(e){return a("el-option",{key:e.tagLevelGroupId,attrs:{label:e.levelName,value:e.tagLevelGroupId}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"三级分类",prop:"cateThree"}},[a("el-input",{attrs:{"auto-complete":"off",placeholder:"请输入分类名称"},nativeOn:{keyup:function(t){var a;a=t,e.toInput(a)}},model:{value:e.cateForm.cateThree,callback:function(t){e.$set(e.cateForm,"cateThree",t)},expression:"cateForm.cateThree"}}),e._v(" "),a("label",{staticClass:"input-label"},[e._v(e._s(e.inputNum)+"/"+e._s(e.limitLength))]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){e.toAddCate("cateForm")}}},[e._v("添加")])],1)],1),e._v(" "),a("el-table",{attrs:{data:e.cateTableData,height:"275"}},[a("el-table-column",{attrs:{label:"分类名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.editAble?"":t.row.levelName)+"\n          "),t.row.editAble?a("el-input",{staticClass:"h5-el-input",attrs:{size:"small",type:"text",placeholder:"请输入分类名称"},nativeOn:{keyup:function(a){var r;r=a,e.toEditInput(r,t.$index,t.row)}},model:{value:t.row.inputValue,callback:function(a){e.$set(t.row,"inputValue",a)},expression:"scope.row.inputValue"}}):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.editAble?e._e():a("el-button",{attrs:{type:"text",size:"small",disabled:!t.row.enterpriseId},on:{click:function(a){e.toEditCate(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),t.row.editAble?e._e():a("el-button",{attrs:{slot:"reference",type:"text",size:"small",disabled:!t.row.enterpriseId},on:{click:function(a){e.toDelCate(t.$index,t.row)}},slot:"reference"},[e._v("删除")]),e._v(" "),t.row.editAble?a("el-button",{attrs:{type:"text"},on:{click:function(a){a.stopPropagation(),e.confirmEdit(t.$index,t.row)}}},[e._v("确认")]):e._e(),e._v(" "),t.row.editAble?a("el-button",{attrs:{type:"text"},on:{click:function(a){a.stopPropagation(),e.cancleEdit(t.$index,t.row)}}},[e._v("取消")]):e._e()]}}])})],1)],1)],1)},staticRenderFns:[]};var h=a("VU/8")(g,d,!1,function(e){a("8WW0")},"data-v-6030522c",null);t.default=h.exports}});