webpackJsonp([22],{KknK:function(e,t){},Lc2x:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i("GXH0"),s=i.n(l),a=i("mw3O"),n=i.n(a),o={name:"links",props:["linkToolsVisible"],data:function(){return{activeName:"first",twoLevelVisible:!1,threeLevelVisible:!1,linksType:"",linksTypeOptions:[],twoLevelValue:"",twoLevelOptions:[],threeLeveloneVisible:!1,threeLevelTreeVisible:!1,threeLevelSearchVisible:!1,threeLevelValue:"",threeLevelOptions:[],h5linkVisible:!1,h5linkObj:{name:"",url:"",fixParam:"",dynamicPara:"",dynamicParaOptions:[{value:"openid",label:"openid"},{value:"unionid",label:"unionid"},{value:"wxOpenid",label:"wxOpenid"},{value:"appkey",label:"appkey"},{value:"enterpriseId",label:"enterpriseId"},{value:"appid",label:"appid"},{value:"memberID",label:"memberID"}]},mylinkToolsVisible:this.linkToolsVisible,goodsLinksVisible:!1,searchGoods:"",category:null,categoryOptions:[],normalizer:function(e){return{id:e.key,label:e.name,children:e.subOptions}},selectGoodId:"",goodsList:[],currentPage:1,pageSize:9,total:0,classify:null,classifyOptions:[],goodsCategory:null,goodsCategoryOptions:[],oneLevelTypeValue:"",twoLevelSelectValue:"",threeLevelSelectValue:"",selectLinkObj:{name:"",url:""}}},methods:{linksTypeChange:function(e){var t="";this.linksTypeOptions.forEach(function(i,l){i.linkId==e&&(t=i)}),this.oneLevelTypeValue=t.type;var i=5==t.type;this.setOneLevelVisible(i,t),this.selectLinkObj.name="",this.selectLinkObj.url="",this.twoLevelSelectValue="",this.threeLevelSelectValue=""},setOneLevelVisible:function(e,t){e?(this.h5linkVisible=!0,this.twoLevelVisible=!1,this.threeLevelVisible=!1,this.goodsLinksVisible=!1):(this.h5linkVisible=!1,this.twoLevelVisible=!0,this.threeLevelVisible=!1,this.goodsLinksVisible=!1,this.twoLevelValue="",this.threeLevelValue="",this.getLinksList(t.linkId,2))},twoLevelValueChange:function(e){var t=this,i="";if(t.twoLevelOptions.forEach(function(t,l){e==t.linkId&&(i=t)}),1==i.type||4==i.type||6==i.type){if(t.threeLevelVisible=!1,t.threeLevelValue="",t.twoLevelSelectValue="",t.threeLevelSelectValue="",t.selectLinkObj.name="",t.selectLinkObj.url="",4==i.type)return t.getGoodsList(),t.getGoodsCategory(),t.getGoodsClassify(),t.threeLevelVisible=!1,t.goodsLinksVisible=!0,!1;t.twoLevelOptions.forEach(function(i,l){e==i.value&&(t.selectLinkObj.name=i.label,t.selectLinkObj.url=i.content)})}else{t.goodsLinksVisible=!1,t.threeLevelVisible=!0,t.threeLevelValue="",t.twoLevelSelectValue="",t.threeLevelSelectValue="";var l=i.type;if(t.setThreeVisible(l,i),2==l)return t.twoLevelSelectValue="sign",!1;if(3==l)return t.twoLevelSelectValue="goodsCate",t.getGoodsClassify(),!1;t.getLinksList(i.linkId,3,l)}},setThreeVisible:function(e,t){switch(e){case 0:this.threeLeveloneVisible=!0,this.threeLevelTreeVisible=!1,this.threeLevelSearchVisible=!1;break;case 2:this.threeLeveloneVisible=!1,this.threeLevelTreeVisible=!1,this.threeLevelSearchVisible=!0,this.selectLinkObj.name=t.name,this.selectLinkObj.url=t.content;break;case 3:this.threeLevelValue=null,this.threeLeveloneVisible=!1,this.threeLevelTreeVisible=!0,this.threeLevelSearchVisible=!1,this.selectLinkObj.name=t.name,this.selectLinkObj.url=t.content}},getGoodsCategory:function(){var e=this;e.axios.post("http://gicdev.demogic.com:9310/api-mall/list_mall_goods_category",n.a.stringify({filterGoods:1,parentId:"tb-cid-11"})).then(function(t){var i=t.data,l="";if(0==i.errorCode){i.result.forEach(function(e,t){"-1"==e.parentId&&(e.subOptions=[],e.key=e.mallCategoryId,l=e,i.result.splice(t,1))});var s=i.result,a=i.result;return s.forEach(function(e,t){0==e.isLeaf&&(e.subOptions=null),e.key=e.mallCategoryId,a.forEach(function(t,i){t.key=t.mallCategoryId,t.parentId==e.mallCategoryId&&(e.subOptions=[],e.subOptions.push(t),s.splice(i,1))})}),s.forEach(function(e,t){l.subOptions.push(e)}),e.categoryOptions=[],e.categoryOptions.push(l),!1}e.$message.error({duration:1e3,message:i.message})}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})},getGoodsClassify:function(){var e=this;e.axios.post("http://gicdev.demogic.com:9310/api-mall/list_mall_goods_tag_tree",n.a.stringify({})).then(function(t){var i=t.data;if(0==i.errorCode){var l=[i.result];return l.forEach(function(t,i){t.name=t.tagName,t.key=t.mallProTagId,t.childTagList&&(t.subOptions=e.checkChildren(t.childTagList))}),e.goodsCategoryOptions=l,void(e.classifyOptions=l)}e.$message.error({duration:1e3,message:i.message})}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})},checkChildren:function(e){var t=this;return e&&e.forEach(function(e,i){e.name=e.tagName,e.key=e.mallProTagId,e.childTagList&&(e.subOptions=t.checkChildren(e.childTagList))}),e},threeLevelValueChange:function(e){},categorySelect:function(e,t){this.category=e.key,this.getGoodsList()},beforeClearCategory:function(e,t){this.category=null,this.getGoodsList()},loadOptions:function(e){var t=e.action,i=e.parentNode;e.callback;"LOAD_CHILDREN_OPTIONS"===t&&i.key&&this.getChildrenNode(i,i.key)},getChildrenNode:function(e,t){var i=this,l={filterGoods:1,parentId:t};i.axios.post("http://gicdev.demogic.com:9310/api-mall/list_mall_goods_category",n.a.stringify(l)).then(function(t){var l=t.data;0!=l.errorCode?i.$message.error({duration:1e3,message:l.message}):e.subOptions=l.result}).catch(function(e){i.$message.error({duration:1e3,message:e.message})})},classifySelect:function(e,t){this.classify=e.key,this.getGoodsList()},beforeClearClassify:function(e,t){this.classify=null,this.getGoodsList()},goodsCategorySelect:function(e,t){},handleClose:function(e){var t=this;t.$confirm("确认关闭？").then(function(i){e(),t.mylinkToolsVisible=!1,t.$emit("linkSelect")}).catch(function(e){})},linkSizeChange:function(e){this.pageSize=e,this.getGoodsList()},linkCurrentChange:function(e){this.currentPage=e,this.getGoodsList()},selectGoodLinkItem:function(e){this.selectGoodId=e.mallProId,this.selectLinkItem(e)},selectLinkItem:function(e){this.selectLinkObj.name=e.proName,this.selectLinkObj.url=e.mallProImageUrl},toSearchInput:function(e){1==this.currentPage?this.getGoodsList():this.currentPage=1},clearInput:function(e){1==this.currentPage?this.getGoodsList():this.currentPage=1},getGoodsList:function(){var e=this,t={pageNum:e.currentPage,searchparams:e.searchGoods||"",pageSize:e.pageSize,mallCategoryId:e.category,tagId:e.classify};e.axios.post("http://gicdev.demogic.com:9310/api-mall/page-mall-goods",n.a.stringify(t)).then(function(t){var i=t.data;if(0==i.errorCode)return e.goodsList=i.result.result,void(e.total=i.result.totalCount);e.$message.error({duration:1e3,message:i.message})}).catch(function(t){e.$message.error({duration:1e3,message:t.message})})},remoteMethod:function(e){""!==e?this.getStoreList(e,this.threeLevelValue):this.threeLevelOptions=[]},cancelLinkSelect:function(){var e=this;this.$confirm("确认关闭?","",{confirmButtonText:"确定",cancelButtonText:"取消",type:""}).then(function(){e.$emit("linkSelect")}).catch(function(){})},confirmLinkSelect:function(){return 5==this.oneLevelTypeValue?this.h5linkObj.name.trim()&&this.h5linkObj.url.trim()?(this.selectLinkObj.name=this.h5linkObj.name,this.selectLinkObj.url=this.h5linkObj.url+"?"+this.h5linkObj.fixParam+"&"+this.h5linkObj.dynamicPara,void this.transData()):void this.$message.error({duration:1e3,message:"请填写链接内容"}):"sign"==this.twoLevelSelectValue?(this.checkTwoLevel(this.twoLevelSelectValue),!1):"goodsCate"==this.twoLevelSelectValue?(this.checkTwoLevel(this.twoLevelSelectValue),!1):void(this.selectLinkObj.name&&this.selectLinkObj.url?this.transData():this.$message.error({duration:1e3,message:"请选择链接"}))},checkTwoLevel:function(e){if(!this.threeLevelValue||!this.threeLevelValue.length)return this.$message.error({duration:1e3,message:"请选择"+("sign"==e?"门店":"商品分类")}),!1;this.selectLinkObj.url=this.selectLinkObj.url+"?"+this.threeLevelValue,this.transData()},resetAll:function(){this.h5linkVisible=!1,this.linksType="",this.twoLevelVisible=!1,this.threeLevelVisible=!1,this.goodsLinksVisible=!1,this.twoLevelValue="",this.twoLevelSelectValue="",this.threeLevelValue="",this.selectLinkObj={url:"",name:""},this.currentPage=1,this.total=0,this.pageSize=9,this.searchGoods="",this.classify=null,this.category=null,this.h5linkObj.name="",this.h5linkObj.url="",this.h5linkObj.fixParam="",this.h5linkObj.dynamicPara=""},transData:function(){this.$emit("linkSelect",this.selectLinkObj),this.resetAll()},getLinksList:function(e,t,i){var l=this;i=i||"";var s={parentId:e};l.axios.post("http://gicdev.demogic.com:9310/api-plug/list-link-data",n.a.stringify(s)).then(function(s){var a=s.data;0!=a.errorCode?l.$message.error({duration:1e3,message:a.message}):l.setLevelListOptions(e,a.result,t,i)}).catch(function(e){l.$message.error({duration:1e3,message:e.message})})},setLevelListOptions:function(e,t,i,l){return 0==e?(t.forEach(function(e,t){e.id=e.linkId,e.label=e.name,e.value=e.linkId}),void(this.linksTypeOptions=t)):2==i&&t[0]?(t.forEach(function(e,t){e.id=e.linkId,e.label=e.name,e.value=e.linkId}),void(this.twoLevelOptions=t)):void 0},getStoreList:function(e,t){var i=this,l={searchParam:e,selectedIds:t.toString(),flag:null};i.axios.post("http://gicdev.demogic.com:9310/api-plug/query-store-by-code-name",n.a.stringify(l)).then(function(e){var t=e.data;if(0==t.errorCode)return t.result.forEach(function(e,t){e.id=e.storeId,e.label=e.storeName,e.value=e.storeId}),void(i.threeLevelOptions=t.result);i.$message.error({duration:1e3,message:t.message})}).catch(function(e){i.$message.error({duration:1e3,message:e.message})})},toLogin:function(){var e=this;e.axios.post("http://gicdev.demogic.com:9310/api-auth/do-login",n.a.stringify({loginName:"damogic",password:"1",eid:"ff808081593917d90159398ec6340012"})).then(function(t){e.getLinksList(0,1)}).catch(function(e){})}},watch:{linkToolsVisible:function(e){this.mylinkToolsVisible=e}},mounted:function(){this.toLogin()},components:{Treeselect:s.a}},r={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"link-tools-contain"},[i("el-dialog",{class:"first"==e.activeName?"min-1026":"min-720",attrs:{title:"链接小工具",visible:e.mylinkToolsVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.mylinkToolsVisible=t}}},[i("div",{staticClass:"links-types"},[i("label",{staticClass:"types-title"},[e._v("链接类型:")]),e._v(" "),i("el-select",{attrs:{placeholder:"请选择"},on:{change:e.linksTypeChange},model:{value:e.linksType,callback:function(t){e.linksType=t},expression:"linksType"}},e._l(e.linksTypeOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),e.twoLevelVisible?i("el-select",{attrs:{placeholder:"请选择"},on:{change:e.twoLevelValueChange},model:{value:e.twoLevelValue,callback:function(t){e.twoLevelValue=t},expression:"twoLevelValue"}},e._l(e.twoLevelOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})):e._e(),e._v(" "),e.threeLevelVisible?i("div",{staticClass:"three-level-wrap"},[e.threeLevelTreeVisible?i("treeselect",{attrs:{options:e.goodsCategoryOptions,normalizer:e.normalizer,"default-expand-level":1,placeholder:"所有分类",noOptionsText:"暂无数据",noResultsText:"无数据"},on:{select:e.goodsCategorySelect},model:{value:e.threeLevelValue,callback:function(t){e.threeLevelValue=t},expression:"threeLevelValue"}}):e._e(),e._v(" "),e.threeLevelSearchVisible?i("el-select",{attrs:{multiple:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.remoteMethod},on:{change:e.threeLevelValueChange},model:{value:e.threeLevelValue,callback:function(t){e.threeLevelValue=t},expression:"threeLevelValue"}},e._l(e.threeLevelOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})):e._e()],1):e._e()],1),e._v(" "),e.h5linkVisible?i("div",{staticClass:"h5link-contain"},[i("div",{staticClass:"h5link-row"},[i("label",{staticClass:"h5link-title"},[e._v("名称:")]),e._v(" "),i("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.h5linkObj.name,callback:function(t){e.$set(e.h5linkObj,"name",t)},expression:"h5linkObj.name"}})],1),e._v(" "),i("div",{staticClass:"h5link-row"},[i("label",{staticClass:"h5link-title"},[e._v("网址:")]),e._v(" "),i("el-input",{attrs:{placeholder:"请输入网址"},model:{value:e.h5linkObj.url,callback:function(t){e.$set(e.h5linkObj,"url",t)},expression:"h5linkObj.url"}}),i("a",{staticClass:"h5link-help",attrs:{href:"http://doc.demogic.com/doc/index.php?s=/41&page_id=441",target:"_blank"}},[e._v("【帮助文档】请联系公司技术人员查看文档配置标准链接")])],1),e._v(" "),i("div",{staticClass:"h5link-row"},[i("label",{staticClass:"h5link-title"},[e._v("固定参数:")]),e._v(" "),i("el-input",{attrs:{type:"textarea",resize:"none",rows:4,placeholder:"请输入固定参数(可选)"},model:{value:e.h5linkObj.fixParam,callback:function(t){e.$set(e.h5linkObj,"fixParam",t)},expression:"h5linkObj.fixParam"}})],1),e._v(" "),i("div",{staticClass:"h5link-row"},[i("label",{staticClass:"h5link-title"},[e._v("动态参数:")]),e._v(" "),i("el-select",{staticClass:"dynamic-param-select",attrs:{multiple:"",placeholder:"请选择动态参数(可选)"},model:{value:e.h5linkObj.dynamicPara,callback:function(t){e.$set(e.h5linkObj,"dynamicPara",t)},expression:"h5linkObj.dynamicPara"}},e._l(e.h5linkObj.dynamicParaOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)]):e._e(),e._v(" "),e.goodsLinksVisible?i("div",{staticClass:"goods-links-contian"},[i("div",{staticClass:"links-tools-row"},[i("treeselect",{attrs:{options:e.categoryOptions,normalizer:e.normalizer,"default-expand-level":1,flat:!0,placeholder:"所有品类",noOptionsText:"暂无数据",noResultsText:"无数据","no-children-text":"无数据","load-options":e.loadOptions,beforeClearAll:e.beforeClearCategory},on:{select:e.categorySelect},model:{value:e.category,callback:function(t){e.category=t},expression:"category"}}),e._v(" "),i("treeselect",{attrs:{options:e.classifyOptions,normalizer:e.normalizer,"default-expand-level":1,placeholder:"所有分类",noOptionsText:"暂无数据",noResultsText:"无数据",noChildrenText:"无数据",beforeClearAll:e.beforeClearClassify},on:{select:e.classifySelect},model:{value:e.classify,callback:function(t){e.classify=t},expression:"classify"}}),e._v(" "),i("el-input",{staticClass:"links-tools-input",attrs:{placeholder:"请输入商品名称/货号",clearable:""},on:{clear:e.clearInput},nativeOn:{keyup:function(t){var i;i=t,e.toSearchInput(i)}},model:{value:e.searchGoods,callback:function(t){e.searchGoods=t},expression:"searchGoods"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),e._v(" "),i("div",{staticClass:"goods-link-content"},[i("ul",{staticClass:"goods-link-list"},e._l(e.goodsList,function(t,l){return i("li",{key:t.proName+l,class:t.mallProId==e.selectGoodId?"goods-link-item goodSelect":"goods-link-item",on:{click:function(i){e.selectGoodLinkItem(t)}}},[i("img",{attrs:{src:t.mallProImageUrl,alt:"商品图片"}}),e._v(" "),i("div",{staticClass:"inline-block goods-message"},[i("p",{staticClass:"limit-2 pro-name"},[e._v(e._s(t.proName))]),e._v(" "),i("p",{staticClass:"gray-color pro-code"},[e._v("货号："+e._s(t.proCode))]),e._v(" "),i("span",{staticClass:"pro-price"},[e._v("￥"+e._s(t.mallProSpuPrice))])])])}))]),e._v(" "),i("div",{staticClass:"links-tools-page"},[i("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[9],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.linkSizeChange,"current-change":e.linkCurrentChange}})],1)]):e._e(),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.cancelLinkSelect}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.confirmLinkSelect}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var c=i("VU/8")(o,r,!1,function(e){i("KknK")},"data-v-4c72a88c",null);t.default=c.exports}});